#!/bin/bash

# Color codes
RED='\033[0;31m'
GREEN='\033[0;32m'
BLUE='\033[0;34m'
YELLOW='\033[1;33m'
NC='\033[0m'

clear
echo -e "${RED}‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó${NC}"
echo -e "${RED}‚ïë         DEBUG ACCOUNTS API ISSUE            ‚ïë${NC}"
echo -e "${RED}‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù${NC}"
echo ""

echo -e "${YELLOW}üîç Step 1: Testing backend health...${NC}"
curl -s http://localhost:8000/health && echo " ‚úÖ Backend OK" || echo " ‚ùå Backend FAILED"
echo ""

echo -e "${YELLOW}üìã Step 2: Testing accounts API directly...${NC}"
curl -s http://localhost:8000/api/v1/accounts | jq . || echo " ‚ùå Accounts API FAILED or no JSON"
echo ""

echo -e "${YELLOW}üîç Step 3: Checking backend logs for errors...${NC}"
docker-compose logs --tail=20 backend | grep -i "error\|exception\|traceback" || echo "No errors in logs"
echo ""

echo -e "${YELLOW}üåê Step 4: Testing from external IP...${NC}"
curl -s http://172.236.219.75:8000/api/v1/accounts | jq . || echo " ‚ùå External API FAILED"
echo ""

echo -e "${YELLOW}üîç Step 5: Checking frontend console errors...${NC}"
echo "Open browser console (F12) and check for:"
echo "  - Network errors in Console tab"
echo "  - Failed requests in Network tab"
echo "  - CORS errors"
echo ""

echo -e "${YELLOW}üìã Step 6: Testing CORS headers...${NC}"
curl -I http://localhost:8000/api/v1/accounts 2>/dev/null | grep -i "access-control" || echo "No CORS headers found"
echo ""

echo -e "${GREEN}‚úÖ DEBUG COMPLETE!${NC}"
echo ""

echo -e "${YELLOW}üîß Quick Fixes to Try:${NC}"
echo -e "   1. Check browser console for API errors"
echo -e "   2. Check if CORS is blocking the request"
echo -e "   3. Check if API URL is correct in frontend"
echo -e "   4. Check if backend is responding to accounts endpoint"
echo ""

echo -e "${YELLOW}üåê Test URLs:${NC}"
echo -e "   Backend:  ${BLUE}http://172.236.219.75:8000/api/v1/accounts${NC}"
echo -e "   Frontend: ${BLUE}http://172.236.219.75:3000/campaigns/new${NC}"
echo ""
