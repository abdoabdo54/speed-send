#!/bin/bash

echo "========================================"
echo "üî• FORCE UPDATING FRONTEND WITH LOGGING"
echo "========================================"
echo ""

cd /opt/speed-send || exit 1

echo "1Ô∏è‚É£ Pulling latest code..."
git pull origin main

echo ""
echo "2Ô∏è‚É£ Stopping frontend container..."
docker-compose stop frontend

echo ""
echo "3Ô∏è‚É£ Removing frontend container and image..."
docker-compose rm -f frontend
docker rmi speed-send-frontend 2>/dev/null || true

echo ""
echo "4Ô∏è‚É£ Rebuilding frontend with no cache..."
docker-compose build --no-cache frontend

echo ""
echo "5Ô∏è‚É£ Starting frontend..."
docker-compose up -d frontend

echo ""
echo "6Ô∏è‚É£ Waiting for frontend to start..."
sleep 10

echo ""
echo "7Ô∏è‚É£ Checking frontend status..."
docker-compose ps frontend

echo ""
echo "8Ô∏è‚É£ Frontend logs..."
docker-compose logs --tail=20 frontend

echo ""
echo "========================================"
echo "‚úÖ FRONTEND UPDATED!"
echo "========================================"
echo ""
echo "üåê Test at: http://172.236.219.75:3000/campaigns/new"
echo ""
echo "üîç When you click 'Send Test Email', you should see:"
echo "   - A full-screen black log window"
echo "   - Detailed step-by-step logging"
echo "   - Backend response details"
echo ""
